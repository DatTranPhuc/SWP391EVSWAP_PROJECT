<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω ph∆∞∆°ng ti·ªán - EV SWAP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/vehicle-manage.css}" href="/css/vehicle-manage.css">
</head>
<body class="vehicle-manage-body" th:attr="data-open-modal=${vehicleError != null}">
<div class="vehicle-manage-background"></div>
<div class="vehicle-manage-glow"></div>

<header class="manage-header container">
    <div class="driver-identity">
        <div class="driver-avatar" th:text="${driverInitial}">D</div>
        <div class="driver-intro">
            <span class="subtitle">Qu·∫£n l√Ω ph∆∞∆°ng ti·ªán</span>
            <h1 class="page-title" th:text="${driverName}">Kiara</h1>
            <p class="page-hint">Theo d√µi tr·∫°ng th√°i pin v√† th√™m ph∆∞∆°ng ti·ªán m·ªõi ch·ªâ v·ªõi v√†i thao t√°c.</p>
        </div>
    </div>
    <div class="header-actions">
        <a class="btn ghost" th:href="@{/dashboard}">Quay v·ªÅ Dashboard</a>
        <button class="btn primary" type="button" onclick="openVehicleModal()">+ Th√™m ph∆∞∆°ng ti·ªán</button>
    </div>
</header>

<main class="manage-main container">
    <div class="alert success" th:if="${vehicleSuccess}" th:text="${vehicleSuccess}"></div>
    <div class="alert error" th:if="${vehicleError}" th:text="${vehicleError}"></div>

    <section class="manage-stats">
        <article class="stat-card">
            <span class="stat-label">T·ªïng s·ªë ph∆∞∆°ng ti·ªán</span>
            <strong class="stat-value" th:text="${totalVehicles}">0</strong>
            <span class="stat-caption">G·ªìm c·∫£ xe ƒëang ho·∫°t ƒë·ªông v√† d·ª± ph√≤ng</span>
        </article>
        <article class="stat-card">
            <span class="stat-label">C·∫≠p nh·∫≠t g·∫ßn nh·∫•t</span>
            <strong class="stat-value" th:text="${lastUpdatedAt != null ? #temporals.format(lastUpdatedAt, 'dd/MM/yyyy HH:mm') : 'Ch∆∞a c√≥'}">16/08/2024 09:24</strong>
            <span class="stat-caption">Th·ªùi ƒëi·ªÉm th√™m ph∆∞∆°ng ti·ªán cu·ªëi c√πng</span>
        </article>
        <article class="stat-card">
            <span class="stat-label">An to√†n h·ªá th·ªëng</span>
            <strong class="stat-value">99.9%</strong>
            <span class="stat-caption">Gi√°m s√°t pin th·ªùi gian th·ª±c, c·∫£nh b√°o t·ª©c th√¨</span>
        </article>
    </section>

    <section class="vehicle-grid" th:if="${#lists.isEmpty(vehicleCards)}">
        <div class="empty-state">
            <div class="empty-icon">üöô</div>
            <h2>Ch∆∞a c√≥ ph∆∞∆°ng ti·ªán n√†o</h2>
            <p>Th√™m ph∆∞∆°ng ti·ªán ƒë·∫ßu ti√™n ƒë·ªÉ EV SWAP theo d√µi t√¨nh tr·∫°ng pin v√† l·ªãch s·ª≠ v·∫≠n h√†nh cho b·∫°n.</p>
            <button class="btn primary" type="button" onclick="openVehicleModal()">Th√™m ph∆∞∆°ng ti·ªán</button>
        </div>
    </section>

    <section class="vehicle-grid" th:if="${!#lists.isEmpty(vehicleCards)}">
        <article class="vehicle-card" th:each="card : ${vehicleCards}">
            <header class="vehicle-card__header">
                <div class="vehicle-main">
                    <h2 class="vehicle-name" th:text="${card.vehicleName()}">Kiara</h2>
                    <span class="status-badge" th:text="${card.statusLabel()}" th:classappend="' ' + ${card.statusBadge()}">Ho·∫°t ƒë·ªông</span>
                </div>
                <div class="vehicle-meta-inline">
                    <span class="plate-label">Bi·ªÉn s·ªë</span>
                    <span class="plate-value" th:text="${card.plateNumber()}">59A3-08364</span>
                </div>
            </header>

            <div class="vehicle-card__body">
                <div class="battery-section">
                    <div class="battery-meta">
                        <div>
                            <span class="meta-label">Model pin</span>
                            <strong class="meta-value" th:text="${card.batteryModel()}">VinFast 48V</strong>
                        </div>
                        <div>
                            <span class="meta-label">Tr·∫°ng th√°i</span>
                            <strong class="meta-value" th:text="${card.batteryStatus()}">ƒêang s·ª≠ d·ª•ng</strong>
                        </div>
                    </div>
                    <div class="battery-progress">
                        <div class="progress-track">
                            <div class="progress-fill" th:style="'width:' + ${card.batteryPercent()} + '%'"></div>
                        </div>
                        <div class="progress-details">
                            <span class="progress-value" th:text="${card.batteryPercent()} + '%'">98%</span>
                            <span class="progress-status" th:text="${card.healthLabel()}">T√¨nh tr·∫°ng tuy·ªát v·ªùi</span>
                        </div>
                        <p class="progress-caption" th:text="${card.healthDescription()}">Pin ho·∫°t ƒë·ªông t·ªëi ∆∞u</p>
                    </div>
                </div>
                <div class="vehicle-details">
                    <div class="detail-item">
                        <span class="detail-label">Model xe</span>
                        <span class="detail-value" th:text="${card.model()}">VinFast Feliz S</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">S·ªë VIN</span>
                        <span class="detail-value" th:text="${card.vin()}">VF9S093983927239</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ng√†y th√™m</span>
                        <span class="detail-value"
                              th:text="${card.createdAt() != null ? #temporals.format(card.createdAt(), 'dd/MM/yyyy HH:mm') : 'Ch∆∞a c·∫≠p nh·∫≠t'}">16/08/2024 09:24</span>
                    </div>
                </div>
            </div>
        </article>
    </section>
</main>

<div class="vehicle-modal" id="vehicleModal" aria-hidden="true" role="dialog">
    <div class="modal-backdrop" onclick="closeVehicleModal()"></div>
    <div class="modal-content" role="document">
        <button class="modal-close" type="button" aria-label="ƒê√≥ng" onclick="closeVehicleModal()">√ó</button>
        <h2>Th√™m ph∆∞∆°ng ti·ªán m·ªõi</h2>
        <p>Nh·∫≠p th√¥ng tin ch√≠nh x√°c ƒë·ªÉ EV SWAP ƒë·ªìng b·ªô d·ªØ li·ªáu v√† ƒë·∫£m b·∫£o pin ph√π h·ª£p.</p>
        <form th:action="@{/vehicles/manage}" method="post" th:object="${vehicleForm}" class="modal-form">
            <div class="form-grid">
                <label>
                    <span>Model xe</span>
                    <input type="text" th:field="*{model}" placeholder="V√≠ d·ª•: VinFast Feliz S" required>
                </label>
                <label>
                    <span>S·ªë VIN</span>
                    <input type="text" th:field="*{vin}" placeholder="VF9S093983927239" required>
                </label>
                <label>
                    <span>Bi·ªÉn s·ªë</span>
                    <input type="text" th:field="*{plateNumber}" placeholder="59A3-08364">
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn ghost" type="button" onclick="closeVehicleModal()">Hu·ª∑</button>
                <button class="btn primary" type="submit">L∆∞u ph∆∞∆°ng ti·ªán</button>
            </div>
        </form>
    </div>
</div>

<script>
    const modal = document.getElementById('vehicleModal');

    function openVehicleModal() {
        modal.setAttribute('aria-hidden', 'false');
        modal.classList.add('is-open');
        document.body.classList.add('modal-open');
        const firstInput = modal.querySelector('input');
        if (firstInput) {
            setTimeout(() => firstInput.focus(), 100);
        }
    }

    function closeVehicleModal() {
        modal.setAttribute('aria-hidden', 'true');
        modal.classList.remove('is-open');
        document.body.classList.remove('modal-open');
    }

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && modal.classList.contains('is-open')) {
            closeVehicleModal();
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        if (document.body.dataset.openModal === 'true') {
            openVehicleModal();
        }
    });
</script>
</body>
</html>
